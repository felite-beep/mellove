<!doctype html>
crypto.getRandomValues(arr);
return Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
}


async function tryUnlock(){
const value = pwInput.value || '';
if(!value) return;
try{
const h = await sha256hex(value);
if(h === storedHash){
// buat token dan set expiry 1 jam dari sekarang
const token = makeToken(24);
const expiry = Date.now() + 60 * 60 * 1000; // 1 jam
sessionStorage.setItem('love_token', token);
sessionStorage.setItem('love_token_expiry', String(expiry));
// opsional: simpan informasi kecil supaya love.html bisa tampil tanpa menanyakan ulang
sessionStorage.setItem('love_unlocked_at', String(Date.now()));
// redirect ke halaman pesan
window.location.href = 'love.html';
} else {
pwInput.value = '';
pwInput.placeholder = 'Salah... coba lagi';
pwInput.focus();
}
}catch(e){console.error(e);}
}


btn.addEventListener('click', tryUnlock);
pwInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') tryUnlock(); });


// Jika sudah punya token valid, langsung redirect
(function(){
try{
const expiry = Number(sessionStorage.getItem('love_token_expiry') || '0');
if(expiry && expiry > Date.now()){
window.location.href = 'love.html';
}
}catch(e){/* ignore */}
})();


// Petunjuk: untuk menghitung hash baru, buka console browser dan jalankan:
// (async () => { const pw = 'aminpalingserius'; const h = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pw)); console.log(Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')); })();
</script>
</body>
</html>
